/*
 * This source file was generated by the Gradle 'init' task
 */
package org.example

import kotlin.math.abs
import org.example.day02_is_safe

fun day01_part1(): Int {

    // Read input
    val lines = read_lines("src/main/resources/day01.txt")

    // Convert lines to pairs of ints
    val pairs: List<Pair<Int, Int>> = lines.map { line: String ->
        val parts = line.split("   ")
        val n1 = parts[0].toInt()
        val n2 = parts[1].toInt()

        Pair(n1, n2)
    }

    // Split up pairs into their own lists and sort them
    val listA = pairs.map { pair -> pair.first }.sorted()
    val listB = pairs.map { pair -> pair.second }.sorted()

    // Get the sum of distances
    var sum = 0
    for (i in listA.indices) {
        sum += abs(listA[i] - listB[i])
    }

    return sum
}

fun day01_part2(): Int {

    // Read input
    val lines = read_lines("src/main/resources/day01.txt")

    // Convert lines to pairs of ints
    val pairs: List<Pair<Int, Int>> = lines.map { line: String ->
        val parts = line.split("   ")
        val n1 = parts[0].toInt()
        val n2 = parts[1].toInt()

        Pair(n1, n2)
    }

    // Split up pairs into their own lists
    val listA = pairs.map { pair -> pair.first }
    val listB = pairs.map { pair -> pair.second }

    // Build frequency map from right list
    var freqMap = HashMap<Int, Int>()
    listB.forEach { n -> 
        if (freqMap.containsKey(n)) {
            val old = freqMap.getValue(n)
            freqMap.replace(n, old+1)
        } else {
            freqMap.put(n, 1)
        }
    }

    // Calculate similarity using frequency map
    var similarity = 0
    listA.forEach { n ->
        if (freqMap.containsKey(n)) {
            val occurences = freqMap.getValue(n)
            similarity += n * occurences
        }
    }

    return similarity
}

fun day02_part1(): Int {

    // Read input as list of list of ints

    val lines = read_lines("src/main/resources/day02.txt")

    val reports: List<List<Int>> = lines.map { line: String ->
        val parts = line.split(" ")
        parts.map {
            s: String -> s.toInt()
        }
    }

    // Figure out which reports are safe
    val safeReports = (reports.map {
        levels: List<Int> -> day02_is_safe(levels)
    }).filter { isSafe -> isSafe }


    return safeReports.size
}

fun day02_part2(): Int {

    // Read input as list of list of ints

    val lines = read_lines("src/main/resources/day02.txt")

    val reports: List<List<Int>> = lines.map { line: String ->
        val parts = line.split(" ")
        parts.map {
            s: String -> s.toInt()
        }
    }

    val safeReports = (reports.map { levels: List<Int> -> 
        // Generate permutations by excluding items
        val permutations: List<List<Int>> = (0..levels.size).map {
            i -> levels.filterIndexed { j, _ -> j != i }
        }

        // Check if one of the permuations are safe
        permutations.map {
            perm -> day02_is_safe(perm)
        }.any { isSafe -> isSafe }
    }).filter { isSafe -> isSafe }

    return safeReports.size
}

fun day03_part1(): Int {

    val str = read_text("src/main/resources/day03.txt")

    val regex = """mul\(\d+,\d+\)""".toRegex()

    val matches = regex.findAll(str)

    var sum = 0
    for (match in matches) {
        val mul = match.value // mul(a,b)
        val argStr = mul.substring(4, mul.length - 1) // a,b
        val args = argStr.split(",").map { s: String -> s.toInt() } // [a, b]

        sum += args[0] * args[1]
    }

    return sum
}

fun day03_part2(): Int {

    val str = read_text("src/main/resources/day03.txt")

    val regex = """(mul\(\d+,\d+\))|(don't\(\))|(do\(\))""".toRegex()

    val matches = regex.findAll(str)

    var sum = 0
    var doMul = true
    for (match in matches) {

        val stmt = match.value

        if (stmt.equals("do()")) { // do()
            doMul = true
        } else if (stmt.equals("don't()")) { // don't()
            doMul = false
        } else if (doMul) { // mul(a,b)
            val argStr = stmt.substring(4, stmt.length - 1) // a,b
            val args = argStr.split(",").map { s: String -> s.toInt() } // [a, b]
    
            sum += args[0] * args[1]
        }

    }

    return sum
}

fun main() {

    println("day03, part 1 solution is '${day03_part1()}'")
    println("day03, part 2 solution is '${day03_part2()}'")

}
